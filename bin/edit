#!/bin/bash

TMPDIR=/tmp
EMACSDIR=/usr/bin

EMACSCLIENT=${EMACSDIR}/emacsclient
EMACS=${EMACSDIR}/emacs

MYUID=$(/usr/bin/id -u)
EMACSSOCK=${TMPDIR}/emacs${MYUID}/server

if [ "$1" = "-w" ]; then
    # We will wait for emacs to finish.
    shift
    if [ -e "${EMACSSOCK}" ]; then
        # There's an emacs server running. Just connect to it (and wait for C-x #).
        emacsclient -c "$@"
    else
        # There's no emacs server running. Just edit in a local emacs.
        ${EMACS} -nw "$@"
    fi
else
    # We won't wait for emacs to finish.
    if [ -e "${EMACSSOCK}" ]; then
        # There's an emacs server running. Just connect to it.
        emacsclient -c --no-wait "$@"
    else
        # There's no emacs running. Launch one.
        nohup ${EMACS} "$@" >/dev/null 2>&1 &
    fi
fi
